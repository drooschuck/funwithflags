-- This script sets up the 'countries' table in your Supabase project.
-- Copy and paste the entire content of this file into the Supabase SQL Editor and run it.

-- Create the countries table
CREATE TABLE public.countries (
  id bigint NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  flag_url text NULL,
  fun_fact text NULL,
  detailed_data jsonb NULL
);

-- Setup the primary key
ALTER TABLE public.countries ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
  SEQUENCE NAME public.countries_id_seq
  START WITH 1
  INCREMENT BY 1
  NO MINVALUE
  NO MAXVALUE
  CACHE 1
);
CREATE UNIQUE INDEX countries_pkey ON public.countries USING btree (id);
CREATE UNIQUE INDEX countries_name_key ON public.countries USING btree (name);
ALTER TABLE public.countries ADD CONSTRAINT countries_pkey PRIMARY KEY USING INDEX countries_pkey;
ALTER TABLE public.countries ADD CONSTRAINT countries_name_key UNIQUE USING INDEX countries_name_key;

-- Enable Row Level Security (RLS)
ALTER TABLE public.countries ENABLE ROW LEVEL SECURITY;

-- Create policies for access
-- 1. Allow authenticated users to read all rows
CREATE POLICY "Allow authenticated read access" ON public.countries
FOR SELECT TO authenticated USING (true);
-- 2. Allow authenticated users to insert rows
CREATE POLICY "Allow authenticated insert access" ON public.countries
FOR INSERT TO authenticated WITH CHECK (true);
-- 3. Allow authenticated users to update rows
CREATE POLICY "Allow authenticated update access" ON public.countries
FOR UPDATE TO authenticated USING (true) WITH CHECK (true);
